<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>El chamizo de Mar√≠a</title>

    <!-- Hoja de estilos -->
    <link rel="stylesheet" href="estilos.css">

    <!-- Fuente de Google -->
    <link href="https://fonts.googleapis.com/css?family=Indie+Flower&display=swap" rel="stylesheet">
</head>

<body>

    <!-- CONTENEDOR GENERAL -->
    <div class="wrapper">

        <!-- CABECERA -->
        <header>
            <h1>
                 <a href="/index.html">üè† EL CHAMIZO DE MAR√çA üè†</a>
            </h1>
        </header>

        <!-- MEN√ö -->
        <nav>
            <ul>
                <li><a href="/aldea.html">Aldea</a></li>
                <li><a href="/planta1.html">Planta 1</a></li>
                <li><a href="/planta2.html">Planta 2</a></li>
                <li><a href="/chamizo-original.html">Chamizo original</a></li>
                <li><a href="/el-creador.html">El creador</a></li>
            </ul>
        </nav>

        <!-- CONTENIDO PRINCIPAL -->
        <main class="no-sidebar">

            <div id="image">
                <img src="images/aldea.png" alt="Foto del chamizo">
            </div>

            <p class="text-page">
                Esta es la aldea en la que se ecnlava el chamizo.
                La visi√≥n es original de <a href="el-creador.html">Gast√≥n, el creador</a>.
            </p>

        </main>

        <!-- PIE DE P√ÅGINA -->
        <footer>
            <p>¬© El chamizo de Mar√≠a ‚Ñ¢</p>
        </footer>

    </div>


    <!--M√öSICA-->
    <div class="jukebox-container" onclick="toggleMusic()">
        <img src="https://minecraft.wiki/images/Jukebox_JE2_BE2.png" alt="Jukebox" id="jukebox-img">
        <p id="music-status">OFF</p>
        
        <audio id="bg-music" loop>
            <source src="/audio/cat.mp3" type="audio/mpeg">
        </audio>
    </div>

    <script>
    const audio = document.getElementById("bg-music");
    const jukebox = document.querySelector(".jukebox-container");

    // 1. Al cargar la p√°gina, comprobar si la m√∫sica deber√≠a estar sonando
    window.addEventListener('load', () => {
        const isPlaying = localStorage.getItem('musicPlaying') === 'true';
        const currentTime = localStorage.getItem('musicTime');

        if (currentTime) {
            audio.currentTime = parseFloat(currentTime);
        }

        if (isPlaying) {
            // Nota: El navegador puede bloquear el play autom√°tico
            // por lo que intentamos reproducir
            audio.play().catch(() => {
                console.log("El navegador bloque√≥ el autoplay. Se requiere un clic.");
                localStorage.setItem('musicPlaying', 'false');
            });
            updateUI(true);
        }
    });

    // 2. Guardar el tiempo actual constantemente
    setInterval(() => {
        if (!audio.paused) {
            localStorage.setItem('musicTime', audio.currentTime);
        }
    }, 1000);

    // 3. Funci√≥n para encender/apagar
    function toggleMusic() {
        if (audio.paused) {
            audio.play();
            localStorage.setItem('musicPlaying', 'true');
            updateUI(true);
        } else {
            audio.pause();
            localStorage.setItem('musicPlaying', 'false');
            updateUI(false);
        }
    }

    function updateUI(playing) {
        const status = document.getElementById("music-status");
        if (playing) {
            jukebox.classList.add("playing");
            status.innerText = "ON";
        } else {
            jukebox.classList.remove("playing");
            status.innerText = "OFF";
        }
    }
    </script>

</body>
</html>